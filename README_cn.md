# å¤§æ¨¡å‹çŸ¥è¯†æœåŠ¡æ¡†æ¶ KAG

[English version](./README.md)
[æ—¥æœ¬èªç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./README_ja.md)

## 1. KAG æ˜¯ä»€ä¹ˆ

æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æŠ€æœ¯æ¨åŠ¨äº†é¢†åŸŸåº”ç”¨ä¸å¤§æ¨¡å‹ç»“åˆã€‚ç„¶è€Œï¼ŒRAG å­˜åœ¨ç€å‘é‡ç›¸ä¼¼åº¦ä¸çŸ¥è¯†æ¨ç†ç›¸å…³æ€§å·®è·å¤§ã€å¯¹çŸ¥è¯†é€»è¾‘ï¼ˆå¦‚æ•°å€¼ã€æ—¶é—´å…³ç³»ã€ä¸“å®¶è§„åˆ™ç­‰ï¼‰ä¸æ•æ„Ÿç­‰é—®é¢˜ï¼Œè¿™äº›éƒ½é˜»ç¢äº†ä¸“ä¸šçŸ¥è¯†æœåŠ¡çš„è½åœ°ã€‚

2024 å¹´ 10 æœˆ 24 æ—¥ï¼ŒOpenSPG å‘å¸ƒ v0.5 ç‰ˆæœ¬ï¼Œæ­£å¼å‘å¸ƒäº†çŸ¥è¯†å¢å¼ºç”Ÿæˆï¼ˆKAGï¼‰çš„ä¸“ä¸šé¢†åŸŸçŸ¥è¯†æœåŠ¡æ¡†æ¶ã€‚KAG æ—¨åœ¨å……åˆ†åˆ©ç”¨çŸ¥è¯†å›¾è°±å’Œå‘é‡æ£€ç´¢çš„ä¼˜åŠ¿ï¼Œæ„å»ºä¸“ä¸šé¢†åŸŸçŸ¥è¯†å¢å¼ºçš„LLMæœåŠ¡æ¡†æ¶ï¼Œæ”¯æŒé€»è¾‘æ¨ç†ã€äº‹å®é—®ç­”ç­‰ã€‚KAGå……åˆ†èåˆäº†çŸ¥è¯†å›¾è°±çš„é€»è¾‘æ€§å’Œäº‹å®æ€§ï¼ŒåŒæ—¶åˆ©ç”¨OpenIEé™ä½é¢†åŸŸæ–‡æ¡£çŸ¥è¯†åŒ–çš„é—¨æ§›ï¼Œé€šè¿‡æ··åˆæ¨ç†ç¼“è§£ä¼ ç»ŸçŸ¥è¯†å›¾è°±çš„ç¨€ç–æ€§é—®é¢˜ã€‚æ®æˆ‘ä»¬æ‰€çŸ¥ï¼ŒKAGæ˜¯å”¯ä¸€ä¸€ä¸ªæ”¯æŒé€»è¾‘æ¨ç†å’Œå¤šè·³äº‹å®é—®ç­”çš„RAGæ¡†æ¶ã€‚å…¶æ ¸å¿ƒç‰¹ç‚¹åŒ…æ‹¬ï¼š

* çŸ¥è¯†ä¸Chunkäº’ç´¢å¼•ç»“æ„ï¼Œä»¥æ•´åˆæ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡æ–‡æœ¬ä¿¡æ¯
* åˆ©ç”¨æ¦‚å¿µè¯­ä¹‰æ¨ç†è¿›è¡ŒçŸ¥è¯†å¯¹é½ï¼Œç¼“è§£OpenIEå¼•å…¥çš„å™ªéŸ³é—®é¢˜
* æ”¯æŒSchema-ConstraintçŸ¥è¯†æ„å»ºï¼Œæ”¯æŒé¢†åŸŸä¸“å®¶çŸ¥è¯†çš„è¡¨ç¤ºä¸æ„å»º
* é€»è¾‘ç¬¦å·å¼•å¯¼çš„æ··åˆæ¨ç†ä¸æ£€ç´¢ï¼Œå®ç°é€»è¾‘æ¨ç†å’Œå¤šè·³æ¨ç†é—®ç­”

KAG åœ¨å¤šè·³é—®ç­”ä»»åŠ¡ä¸­æ˜¾è‘—ä¼˜äº NaiveRAGã€HippoRAG ç­‰æ–¹æ³•ï¼Œåœ¨ hotpotQA ä¸Šçš„ F1 åˆ†æ•°ç›¸å¯¹æé«˜äº† 19.6%ï¼Œåœ¨ 2wiki ä¸Šçš„ F1 åˆ†æ•°ç›¸å¯¹æé«˜äº† 33.5%ã€‚æˆ‘ä»¬å·²æˆåŠŸå°† KAG åº”ç”¨äºèš‚èšé›†å›¢çš„ç”µå­æ”¿åŠ¡é—®ç­”å’Œç”µå­å¥åº·é—®ç­”ç­‰ä¸“ä¸šçŸ¥è¯†æœåŠ¡åœºæ™¯ï¼Œä¸ RAG æ–¹æ³•ç›¸æ¯”ï¼Œä¸“ä¸šæ€§å’Œå‡†ç¡®ç‡æœ‰äº†æ˜¾è‘—æé«˜ã€‚

â­ï¸ç‚¹å‡»å³ä¸Šè§’çš„ Star å…³æ³¨ KAGï¼Œå¯ä»¥è·å–æœ€æ–°å‘å¸ƒçš„å®æ—¶é€šçŸ¥ï¼ğŸŒŸ

![Star KAG](./_static/images/star-kag.gif)

### 1.1 æŠ€æœ¯æ¶æ„

![å›¾1 KAG æŠ€æœ¯æ¶æ„](./_static/images/kag-arch.png)

å›¾1 KAG æŠ€æœ¯æ¶æ„

KAG æ¡†æ¶åŒ…æ‹¬ kg-builderã€kg-solverã€kag-model ä¸‰éƒ¨åˆ†ã€‚æœ¬æ¬¡å‘å¸ƒåªæ¶‰åŠå‰ä¸¤éƒ¨åˆ†ï¼Œkag-model å°†åœ¨åç»­é€æ­¥å¼€æºå‘å¸ƒã€‚

kg-builder å®ç°äº†ä¸€ç§å¯¹å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å‹å¥½çš„çŸ¥è¯†è¡¨ç¤ºï¼Œåœ¨ DIKWï¼ˆæ•°æ®ã€ä¿¡æ¯ã€çŸ¥è¯†å’Œæ™ºæ…§ï¼‰çš„å±‚æ¬¡ç»“æ„åŸºç¡€ä¸Šï¼Œå‡çº§ SPG çŸ¥è¯†è¡¨ç¤ºèƒ½åŠ›ï¼Œåœ¨åŒä¸€çŸ¥è¯†ç±»å‹ï¼ˆå¦‚å®ä½“ç±»å‹ã€äº‹ä»¶ç±»å‹ï¼‰ä¸Šå…¼å®¹æ—  schema çº¦æŸçš„ä¿¡æ¯æå–å’Œæœ‰ schema çº¦æŸçš„ä¸“ä¸šçŸ¥è¯†æ„å»ºï¼Œå¹¶æ”¯æŒå›¾ç»“æ„ä¸åŸå§‹æ–‡æœ¬å—ä¹‹é—´çš„äº’ç´¢å¼•è¡¨ç¤ºï¼Œä¸ºæ¨ç†é—®ç­”é˜¶æ®µçš„é«˜æ•ˆæ£€ç´¢æä¾›æ”¯æŒã€‚

kg-solver é‡‡ç”¨é€»è¾‘å½¢å¼å¼•å¯¼çš„æ··åˆæ±‚è§£å’Œæ¨ç†å¼•æ“ï¼Œè¯¥å¼•æ“åŒ…æ‹¬ä¸‰ç§ç±»å‹çš„è¿ç®—ç¬¦ï¼šè§„åˆ’ã€æ¨ç†å’Œæ£€ç´¢ï¼Œå°†è‡ªç„¶è¯­è¨€é—®é¢˜è½¬åŒ–ä¸ºç»“åˆè¯­è¨€å’Œç¬¦å·çš„é—®é¢˜æ±‚è§£è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ­¥éƒ½å¯ä»¥åˆ©ç”¨ä¸åŒçš„è¿ç®—ç¬¦ï¼Œå¦‚ç²¾ç¡®åŒ¹é…æ£€ç´¢ã€æ–‡æœ¬æ£€ç´¢ã€æ•°å€¼è®¡ç®—æˆ–è¯­ä¹‰æ¨ç†ï¼Œä»è€Œå®ç°å››ç§ä¸åŒé—®é¢˜æ±‚è§£è¿‡ç¨‹çš„é›†æˆï¼šæ£€ç´¢ã€çŸ¥è¯†å›¾è°±æ¨ç†ã€è¯­è¨€æ¨ç†å’Œæ•°å€¼è®¡ç®—ã€‚

### 1.2 çŸ¥è¯†è¡¨ç¤º

ç§åŸŸçŸ¥è¯†åº“åœºæ™¯ï¼Œéç»“æ„åŒ–æ•°æ®ã€ç»“æ„åŒ–ä¿¡æ¯ã€ä¸šåŠ¡ä¸“å®¶ç»éªŒ å¾€å¾€ä¸‰è€…å…±å­˜ï¼ŒKAG å‚è€ƒäº† DIKW å±‚æ¬¡ç»“æ„ï¼Œå°† SPG å‡çº§ä¸ºå¯¹ LLM å‹å¥½çš„ç‰ˆæœ¬ã€‚é’ˆå¯¹æ–°é—»ã€äº‹ä»¶ã€æ—¥å¿—ã€ä¹¦ç±ç­‰éç»“æ„åŒ–æ•°æ®ï¼Œäº¤æ˜“ã€ç»Ÿè®¡ã€å®¡æ‰¹ç­‰ç»“æ„åŒ–æ•°æ®ï¼Œä¸šåŠ¡ç»éªŒã€é¢†åŸŸçŸ¥è¯†ç­‰è§„åˆ™ï¼ŒKAG é‡‡ç”¨ç‰ˆé¢åˆ†æã€çŸ¥è¯†æŠ½å–ã€å±æ€§æ ‡åŒ–ã€è¯­ä¹‰å¯¹é½ç­‰æŠ€æœ¯ï¼Œå°†åŸå§‹çš„ä¸šåŠ¡æ•°æ®&ä¸“å®¶è§„åˆ™èåˆåˆ°ç»Ÿä¸€çš„ä¸šåŠ¡çŸ¥è¯†å›¾è°±ä¸­ã€‚

![KAG ç¤ºæ„å›¾](./_static/images/kag-diag.jpg)

è¿™ä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨åŒä¸€çŸ¥è¯†ç±»å‹ï¼ˆå¦‚å®ä½“ç±»å‹ã€äº‹ä»¶ç±»å‹ï¼‰ä¸Šå…¼å®¹æ—  schema çº¦æŸçš„ä¿¡æ¯æå–å’Œæœ‰ schema çº¦æŸçš„ä¸“ä¸šçŸ¥è¯†æ„å»ºï¼Œå¹¶æ”¯æŒå›¾ç»“æ„ä¸åŸå§‹æ–‡æœ¬å—ä¹‹é—´çš„äº’ç´¢å¼•è¡¨ç¤ºã€‚è¿™ç§äº’ç´¢å¼•è¡¨ç¤ºæœ‰åŠ©äºåŸºäºå›¾ç»“æ„çš„å€’æ’ç´¢å¼•çš„æ„å»ºï¼Œå¹¶ä¿ƒè¿›äº†é€»è¾‘å½¢å¼çš„ç»Ÿä¸€è¡¨ç¤ºã€æ¨ç†ã€‚

### 1.3 é€»è¾‘å½¢å¼å¼•å¯¼çš„æ··åˆæ¨ç†

![Logical Form Solver](./_static/images/kag-lf-solver.png)

KAG æå‡ºäº†ä¸€ç§é€»è¾‘å½¢å¼å¼•å¯¼çš„æ··åˆæ±‚è§£å’Œæ¨ç†å¼•æ“ã€‚è¯¥å¼•æ“åŒ…æ‹¬ä¸‰ç§ç±»å‹çš„è¿ç®—ç¬¦ï¼šè§„åˆ’ã€æ¨ç†å’Œæ£€ç´¢ï¼Œå°†è‡ªç„¶è¯­è¨€é—®é¢˜è½¬åŒ–ä¸ºç»“åˆè¯­è¨€å’Œç¬¦å·çš„é—®é¢˜æ±‚è§£è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ­¥éƒ½å¯ä»¥åˆ©ç”¨ä¸åŒçš„è¿ç®—ç¬¦ï¼Œå¦‚ç²¾ç¡®åŒ¹é…æ£€ç´¢ã€æ–‡æœ¬æ£€ç´¢ã€æ•°å€¼è®¡ç®—æˆ–è¯­ä¹‰æ¨ç†ï¼Œä»è€Œå®ç°å››ç§ä¸åŒé—®é¢˜æ±‚è§£è¿‡ç¨‹çš„é›†æˆï¼šæ£€ç´¢ã€çŸ¥è¯†å›¾è°±æ¨ç†ã€è¯­è¨€æ¨ç†å’Œæ•°å€¼è®¡ç®—ã€‚

## 2. æ•ˆæœå¦‚ä½•

### 2.1 å…¬å¼€æ•°æ®é›†çš„æ•ˆæœï¼ˆå¤šè·³æ¨ç†ï¼‰

![KAG æ•ˆæœæŒ‡æ ‡](./_static/images/kag-perf.webp)

ç»è¿‡ä¼˜åŒ–ï¼Œæˆ‘ä»¬ä¸ä»…éªŒè¯äº† KAG åœ¨å‚ç›´é¢†åŸŸçš„é€‚åº”æ€§ï¼Œæˆ‘ä»¬è¿˜åœ¨é€šç”¨æ•°æ®é›†å¤šè·³é—®ç­”ä¸­ä¸ç°æœ‰ RAG æ–¹æ³•è¿›è¡Œäº†æ¯”è¾ƒï¼Œå‘ç°å®ƒæ˜æ˜¾ä¼˜äº SOTA æ–¹æ³•ï¼Œåœ¨ 2wiki ä¸Š F1 ç›¸å¯¹æå‡ 33.5%ï¼Œåœ¨ hotpotQA ä¸Šç›¸å¯¹æé«˜ 19.6% ã€‚ æˆ‘ä»¬æ­£åœ¨ç»§ç»­ä¼˜åŒ–è¿™ä¸€æ¡†æ¶ï¼Œå¹¶é€šè¿‡ç«¯åˆ°ç«¯å®éªŒå’Œæ¶ˆèå®éªŒæŒ‡æ ‡è¯æ˜äº†å…¶æœ‰æ•ˆæ€§ã€‚é€šè¿‡é€»è¾‘ç¬¦å·é©±åŠ¨çš„æ¨ç†å’Œæ¦‚å¿µå¯¹é½çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¯å®äº†è¿™ä¸€æ¡†æ¶çš„æœ‰æ•ˆæ€§ã€‚

### 2.2 é¢†åŸŸçŸ¥è¯†åœºæ™¯çš„æ•ˆæœï¼ˆé£é™©æŒ–æ˜ï¼‰

#### 2.2.1 ä¸“å®¶è§„åˆ™å®šä¹‰

* å®šä¹‰â€œèµŒåšAPPâ€è®¤å®šè§„åˆ™

  **define riskAppTaxo rule**

  ```text
  Define (s:App)-[p:belongTo]->(o:`TaxOfRiskApp`/`GamblingApp`) {
      Structure {
          (s)
      }
      Constraint {
          R1("risk label marked as gambling") s.riskMark like "%Gambling%"
    }
  }
  ```

* å®šä¹‰ â€œAppå¼€å‘è€…â€è®¤å®šè§„åˆ™

  **define app developper rule**

  ```text
  Define (s:Person)-[p:developed]->(o:App) {
      Structure {
          (s)-[:hasDevice]->(d:Device)-[:install]->(o)
      }
      Constraint {
          deviceNum = group(s,o).count(d)
          R1("device installed same app"): deviceNum > 5
      }
  }
  ```

* å®šä¹‰ â€œèµŒåšApp å¼€å‘è€…â€è®¤å®šè§„åˆ™

  **define a RiskUser of gambling app rule**

  ```text
  Define (s:Person)-[p:belongTo]->(o:`TaxOfRiskUser`/`DeveloperOfGamblingApp`) {
      Structure {
          (s)-[:developed]->(app:`TaxOfRiskApp`/`GamblingApp`)
      }
      Constraint {
      }
  }
  ```

#### 2.2.2 ä¸šåŠ¡æ•°æ®

![KAG ä¸šåŠ¡æ•°æ®](./_static/images/kag-biz-data.png)

#### 2.2.3 æ¨ç†è¿‡ç¨‹

![KAG æ¨ç†è¿‡ç¨‹](./_static/images/kag-reason.png)

æ¨ç†è¿‡ç¨‹ä¸­ï¼Œå…³é”®æ­¥éª¤å¦‚ä¸‹å‡ æ­¥ã€‚

* å°†è‡ªç„¶è¯­è¨€é—®é¢˜è½¬æ¢æˆå¯æ‰§è¡Œçš„é€»è¾‘è¡¨è¾¾å¼ï¼Œæ­¤å¤„ä¾èµ–çš„æ˜¯é¡¹ç›®ä¸‹çš„æ¦‚å¿µå»ºæ¨¡ï¼Œå¯å‚è€ƒé»‘äº§æŒ–æ˜æ–‡æ¡£ã€‚

* å°†è½¬æ¢çš„é€»è¾‘è¡¨è¾¾å¼æäº¤åˆ° OpenSPG reasoner æ‰§è¡Œï¼Œå¾—åˆ°ç”¨æˆ·çš„åˆ†ç±»ç»“æœã€‚

* å°†ç”¨æˆ·çš„åˆ†ç±»ç»“æœè¿›è¡Œç­”æ¡ˆç”Ÿæˆã€‚

KAG ç»“åˆ OpenSPG æ¦‚å¿µå»ºæ¨¡ï¼Œå¯ä»¥é™ä½è‡ªç„¶è¯­è¨€è½¬æ¢å›¾æŸ¥è¯¢çš„éš¾åº¦ï¼Œå°†é¢å‘æ•°æ®çš„è½¬æ¢å˜ä¸ºé¢å‘åˆ†ç±»æ¦‚å¿µçš„è½¬æ¢ï¼Œå¯åœ¨åŸæœ‰ OpenSPG é¡¹ç›®ä¸Šå¿«é€Ÿå®ç°è‡ªç„¶è¯­è¨€é—®ç­”çš„é¢†åŸŸåº”ç”¨ã€‚

## 3. æ€æ ·ä½¿ç”¨

### 3.1 åŸºäºäº§å“ï¼ˆé¢å‘æ™®é€šç”¨æˆ·ï¼‰

#### 3.1.1 å¼•æ“&ä¾èµ– é•œåƒå®‰è£…

* **æ¨èç³»ç»Ÿç‰ˆæœ¬ï¼š**

  ```text
  macOS ç”¨æˆ·ï¼šmacOS Monterey 12.6 æˆ–æ›´æ–°ç‰ˆæœ¬
  Linux ç”¨æˆ·ï¼šCentOS 7 / Ubuntu 20.04 æˆ–æ›´æ–°ç‰ˆæœ¬
  Windows ç”¨æˆ·ï¼šWindows 10 LTSC 2021 æˆ–æ›´æ–°ç‰ˆæœ¬
  ```

* **è½¯ä»¶è¦æ±‚ï¼š**

  ```text
  macOS / Linux ç”¨æˆ·ï¼šDockerï¼ŒDocker Compose
  Windows ç”¨æˆ·ï¼šWSL 2 / Hyper-Vï¼ŒDockerï¼ŒDocker Compose
  ```

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½ docker-compose.yml å¹¶ç”¨ Docker Compose å¯åŠ¨æœåŠ¡ã€‚

```bash
# è®¾ç½® HOME ç¯å¢ƒå˜é‡ï¼ˆä»… Windows ç”¨æˆ·éœ€è¦æ‰§è¡Œï¼‰
# set HOME=%USERPROFILE%

curl -sSL https://raw.githubusercontent.com/OpenSPG/openspg/refs/heads/master/dev/release/docker-compose.yml -o docker-compose.yml
docker compose -f docker-compose.yml up -d
```

#### 3.1.2 ä½¿ç”¨

æµè§ˆå™¨æ‰“å¼€ KAG äº§å“é»˜è®¤é“¾æ¥ï¼š<http://127.0.0.1:8887> ã€‚

å…·ä½“ä½¿ç”¨å‚è€ƒ[äº§å“ä½¿ç”¨](https://openspg.yuque.com/ndx6g9/0.0.5/bv9zc3gyi98k0oyx)ä»‹ç»ã€‚

### 3.2 åŸºäºå·¥å…·åŒ…ï¼ˆé¢å‘å¼€å‘è€…ï¼‰

#### 3.2.1 å¼•æ“&ä¾èµ– é•œåƒå®‰è£…

å‚è€ƒ 3.1 éƒ¨åˆ†å®Œæˆå¼•æ“&ä¾èµ–çš„é•œåƒå®‰è£…ã€‚

#### 3.2.2 KAG å®‰è£…

**macOS / Linux å¼€å‘è€…**

```text
# å®‰è£… Python è™šæ‹Ÿç¯å¢ƒï¼šconda create -n kag-demo python=3.10 && conda activate kag-demo

# ä»£ç  cloneï¼šgit clone https://github.com/OpenSPG/KAG.git

# KAG å®‰è£…: cd KAG && pip install -e .
```

**Windows å¼€å‘è€…**

```
# å®‰è£…å®˜æ–¹ Python 3.8.10 æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œå®‰è£… Gitã€‚

# åˆ›å»ºã€æ¿€æ´» Python è™šæ‹Ÿç¯å¢ƒï¼špy -m venv kag-demo && kag-demo\Scripts\activate

# ä»£ç  cloneï¼šgit clone https://github.com/OpenSPG/KAG.git

# KAG å®‰è£…: cd KAG && pip install -e .
```

#### 3.2.3 ä½¿ç”¨

å¼€å‘è€…å¯ä»¥å‚è€ƒ [KAG æ¡ˆä¾‹](https://openspg.yuque.com/ndx6g9/0.5/vbbdp80vg0xf5n3k)ï¼ŒåŸºäº KAG å†…ç½®çš„å„ç§ç»„ä»¶ï¼Œå®ç°å†…ç½®æ•°æ®é›†çš„æ•ˆæœå¤ç° + æ–°åœºæ™¯çš„è½åœ°ã€‚

## 4. å¦‚ä½•æ‰©å±•

### 4.1 æ‰©å±• KAG èƒ½åŠ›

å¦‚æœ KAG æä¾›çš„ç»„ä»¶ä¸æ»¡è¶³è¦æ±‚ï¼Œå¼€å‘è€…å¯ä»¥è‡ªè¡Œæ‰©å±• kag-builderã€kag-solver çš„å®ç°ã€‚è¯¦ç»†ä»‹ç»å‚è€ƒ [kag-builder ç»„ä»¶ä»‹ç»](https://openspg.yuque.com/ndx6g9/0.5/dvivn76geywr7lc4)ã€[kag-solver ç»„ä»¶ä»‹ç»](https://openspg.yuque.com/ndx6g9/0.5/nzsxb8p2nf7kztlz)ã€‚

#### 4.1.1 kag-builder æ‰©å±•

![KAG Chain ç¤ºæ„å›¾](./_static/images/kag-chain.png)

KAG é€šè¿‡ BuilderChain ä¸²è” readerã€splitterã€mappingã€extractorã€alignerã€vectorizer ç­‰ç»„ä»¶ã€‚å¼€å‘è€…å¯ä½¿ç”¨ KAG é¢„å®šçš„ BuilderChain å®Œæˆå›¾è°±æ„å»ºï¼Œä¹Ÿå¯ä»¥ç»„è£…é¢„å®šä¹‰ç»„ä»¶å¹¶è·å–BuilderChainã€‚

åŒæ—¶ï¼Œå¼€å‘è€…å¯è‡ªå®šä¹‰ builder ä¸­çš„ç»„ä»¶ï¼Œå¹¶åµŒå…¥åˆ° BuilderChain ä¸­æ‰§è¡Œã€‚

```text
kag
â”œâ”€â”€interface
â”‚  â”œâ”€â”€ builder
â”‚  â”‚   â”œâ”€â”€ aligner_abc.py
â”‚  â”‚   â”œâ”€â”€ extractor_abc.py
â”‚  â”‚   â”œâ”€â”€ mapping_abc.py
â”‚  â”‚   â”œâ”€â”€ reader_abc.py
â”‚  â”‚   â”œâ”€â”€ splitter_abc.py
â”‚  â”‚   â”œâ”€â”€ vectorizer_abc.py
â”‚  â”‚   â””â”€â”€ writer_abc.py
```

#### 4.1.2 kag-solver æ‰©å±•

kag-solver é€šè¿‡ solver-pipeline ä¸²è” reasonerã€generatorã€reflector ç»„ä»¶æ‰§è¡Œã€‚KAG æä¾›äº†é»˜è®¤çš„ reasonerã€generatorã€reflectorï¼Œå¼€å‘è€…ä¹Ÿå¯åŸºäºä¸‹è¿°æ¥å£æ‰©å±•è‡ªå®šä¹‰å®ç°ï¼š

```text
kag
â”œâ”€â”€ solver
â”‚   â”œâ”€â”€ logic
â”‚   â”‚   â””â”€â”€ solver_pipeline.py
â”œâ”€â”€ interface
    â”œâ”€â”€ retriever
    â”‚   â”œâ”€â”€ chunk_retriever_abc.py
    â”‚   â””â”€â”€ kg_retriever_abc.py
    â””â”€â”€ solver
        â”œâ”€â”€ kag_generator_abc.py
        â”œâ”€â”€ kag_memory_abc.py
        â”œâ”€â”€ kag_reasoner_abc.py
        â”œâ”€â”€ kag_reflector_abc.py
        â””â”€â”€ lf_planner_abc.py
```

### 4.2 KAG é€‚é…åˆ°å®šåˆ¶æ¨¡å‹

#### 4.2.1 ç”Ÿæˆæ¨¡å‹é€‚é…

KAG æ”¯æŒä¸ Qwen / DeepSeek / GPT ç­‰ OpenAI æ¥å£å…¼å®¹çš„ MaaS ç±» API å¯¹æ¥ï¼Œä¹Ÿæ”¯æŒåŸºäº vLLM / Ollama åŠ è½½çš„æœ¬åœ°æ¨¡å‹å¯¹æ¥ã€‚å¼€å‘è€…å¯åŸºäº llm_client æ¥å£ï¼Œæ·»åŠ å¯¹è‡ªå®šä¹‰æ¨¡å‹æœåŠ¡çš„æ”¯æŒã€‚

**å¤§æ¨¡å‹é€‚é…æ¥å£å®šä¹‰**

```text
kag
â”œâ”€â”€ common
  â”œâ”€â”€ llm
    â”œâ”€â”€ client
    â”‚   â”œâ”€â”€ llm_client.py
    â”‚   â”œâ”€â”€ ollama_client.py
    â”‚   â”œâ”€â”€ openai_client.py
    â”‚   â”œâ”€â”€ vllm_client.py
```

#### 4.2.2 è¡¨ç¤ºæ¨¡å‹é€‚é…

KAG æ”¯æŒè°ƒç”¨ OpenAI ç±»è¡¨ç¤ºæ¨¡å‹çš„æ¥å£è°ƒç”¨ï¼ŒåŒ…æ‹¬ OpenAI embedding serviceã€Ollama åŠ è½½çš„ bge-enã€bge-zh ç­‰ï¼›ä¹Ÿæ”¯æŒ local æ–¹å¼å®Œæˆæ¨¡å‹çš„åŠ è½½&ä½¿ç”¨ã€‚

**è¡¨ç¤ºæ¨¡å‹é€‚é…æ¥å£å®šä¹‰**

```text
kag
â”œâ”€â”€ common
  â”œâ”€â”€ vectorizer
  â”‚   â”œâ”€â”€ vectorizer.py
  â”‚   â”œâ”€â”€ openai_vectorizer.py
  â”‚   â”œâ”€â”€ local_bge_m3_vectorizer.py
  â”‚   â”œâ”€â”€ local_bge_vectorizer.py
```

### 4.3 KAG é›†æˆåˆ°å…¶å®ƒæ¡†æ¶

åœ¨äºå…¶å®ƒæ¡†æ¶é›†æˆæ—¶ï¼Œå¯å°†å¤–éƒ¨ä¸šåŠ¡æ•°æ®&ä¸“å®¶çŸ¥è¯†ä½œä¸ºè¾“å…¥ï¼Œè°ƒç”¨ kag-builder pipeline å®Œæˆå›¾è°±æ„å»ºã€‚ä¹Ÿå¯ä»¥è°ƒç”¨ kag-solver å®Œæˆæ¨ç†é—®ç­”ï¼Œå¹¶å°†æ¨ç†ç»“æœ&ä¸­é—´è¿‡ç¨‹é€å‡ºåˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­ã€‚

å…¶å®ƒæ¡†æ¶é›†æˆ KAG çš„æ–¹å¼å¯ä»¥ç®€å•æè¿°ä¸ºï¼š

![KAG ä¸å…¶ä»–æ¡†æ¶é›†æˆ](./_static/images/kag-integrate.png)

## 5. åç»­è®¡åˆ’

* é¢†åŸŸçŸ¥è¯†æ³¨å…¥ï¼Œå®ç°é¢†åŸŸæ¦‚å¿µå›¾ä¸å®ä½“å›¾çš„èåˆ

* kag-model ä¼˜åŒ–ï¼Œå®ç°æ„å›¾&é—®ç­”çš„æ•ˆç‡æå‡

* çŸ¥è¯†é€»è¾‘çº¦æŸçš„å¹»è§‰æŠ‘åˆ¶

## 6. è”ç³»æˆ‘ä»¬

**GitHub**: <https://github.com/OpenSPG/KAG>

**OpenSPG**: <https://spg.openkg.cn/>

<img src="./_static/images/openspg-qr.png" alt="è”ç³»æˆ‘ä»¬ï¼šOpenSPG äºŒç»´ç " width="200">

# å¼•ç”¨

å¦‚æœæ‚¨ä½¿ç”¨æœ¬è½¯ä»¶ï¼Œè¯·ä»¥ä¸‹é¢çš„æ–¹å¼å¼•ç”¨ï¼š

* [KAG: Boosting LLMs in Professional Domains via Knowledge Augmented Generation](https://arxiv.org/abs/2409.13731)
* KGFabric: A Scalable Knowledge Graph Warehouse for Enterprise Data Interconnection

```bibtex
@article{liang2024kag,
  title={KAG: Boosting LLMs in Professional Domains via Knowledge Augmented Generation},
  author={Liang, Lei and Sun, Mengshu and Gui, Zhengke and Zhu, Zhongshu and Jiang, Zhouyu and Zhong, Ling and Qu, Yuan and Zhao, Peilong and Bo, Zhongpu and Yang, Jin and others},
  journal={arXiv preprint arXiv:2409.13731},
  year={2024}
}

@article{yikgfabric,
  title={KGFabric: A Scalable Knowledge Graph Warehouse for Enterprise Data Interconnection},
  author={Yi, Peng and Liang, Lei and Da Zhang, Yong Chen and Zhu, Jinye and Liu, Xiangyu and Tang, Kun and Chen, Jialin and Lin, Hao and Qiu, Leijie and Zhou, Jun}
}
```

# è®¸å¯åè®®

[Apache License 2.0](LICENSE)
